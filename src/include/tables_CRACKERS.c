#include <genesis.h>





#include "structures.h"
#include "variables.h"




#include "maps_CRACKERS.h"




//------------------------------------------------------------------//
//                                                                  //
//                         SPREAD POSITIONS                         //
//                                                                  //
//------------------------------------------------------------------//






const s16                   TABLE_POSITION_CRACKERS_1[14][2]     =   {
                                                                        {120,88},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL}

                                                                    };

const s16                   TABLE_POSITION_CRACKERS_2[14][2]     =   {
                                                                        {120,88},
                                                                        {232,155},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL}
                                                                    };

const s16                   TABLE_POSITION_CRACKERS_3[14][2]     =   {
                                                                        {40,142},
                                                                        {120,88},
                                                                        {232,155},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL}
                                                                    };

const s16                   TABLE_POSITION_CRACKERS_4[14][2]   =     {
                                                                        {40,142},
                                                                        {120,88},
                                                                        {136,155},
                                                                        {232,155},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL}
                                                                    };

const s16                   TABLE_POSITION_CRACKERS_5[14][2]   =     {
                                                                        {40,142},
                                                                        {120,88},
                                                                        {136,155},
                                                                        {168,89},
                                                                        {232,155},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL}
                                                                    };

const s16                   TABLE_POSITION_CRACKERS_6[14][2]   =     {
                                                                        {40,142},
                                                                        {88,142},
                                                                        {120,88},
                                                                        {136,155},
                                                                        {168,89},
                                                                        {232,155},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL}
                                                                    };

const s16                   TABLE_POSITION_CRACKERS_7[14][2]   =     {
                                                                        {40,142},
                                                                        {88,142},
                                                                        {120,88},
                                                                        {136,155},
                                                                        {168,89},
                                                                        {184,122},
                                                                        {232,155},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL}
                                                                    };

const s16                   TABLE_POSITION_CRACKERS_8[14][2]   =     {
                                                                        {40,142},
                                                                        {88,142},
                                                                        {120,88},
                                                                        {136,122},
                                                                        {136,155},
                                                                        {168,89},
                                                                        {184,122},
                                                                        {232,155},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL}
                                                                    };

const s16                   TABLE_POSITION_CRACKERS_9[14][2]   =   {
                                                                        {40,142},
                                                                        {88,142},
                                                                        {120,88},
                                                                        {136,122},
                                                                        {136,155},
                                                                        {168,89},
                                                                        {184,122},
                                                                        {232,122},
                                                                        {232,155},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                    };

const s16                   TABLE_POSITION_CRACKERS_10[14][2]   =   {
                                                                        {40,142},
                                                                        {88,142},
                                                                        {120,88},
                                                                        {136,122},
                                                                        {136,155},
                                                                        {168,89},
                                                                        {184,122},
                                                                        {184,155},
                                                                        {232,122},
                                                                        {232,155},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL}
                                                                    };

const s16                   TABLE_POSITION_CRACKERS_11[14][2]   =   {
                                                                        {40,142},
                                                                        {72,110},
                                                                        {88,142},
                                                                        {120,88},
                                                                        {136,122},
                                                                        {136,155},
                                                                        {168,89},
                                                                        {184,122},
                                                                        {184,155},
                                                                        {232,122},
                                                                        {232,155},
                                                                        {NULL},
                                                                        {NULL},
                                                                        {NULL}
                                                                    };

const s16                   TABLE_POSITION_CRACKERS_12[14][2]   =   {
                                                                        {40,142},
                                                                        {72,110},
                                                                        {72,175},
                                                                        {88,142},
                                                                        {120,88},
                                                                        {136,122},
                                                                        {136,155},
                                                                        {168,89},
                                                                        {184,122},
                                                                        {184,155},
                                                                        {232,122},
                                                                        {232,155},
                                                                        {NULL},
                                                                        {NULL}
                                                                    };

const s16                   TABLE_POSITION_CRACKERS_13[14][2]   =   {
                                                                        {40,142},
                                                                        {72,110},
                                                                        {72,175},
                                                                        {88,142},
                                                                        {120,88},
                                                                        {136,122},
                                                                        {136,155},
                                                                        {168,89},
                                                                        {184,122},
                                                                        {184,155},
                                                                        {168,187},
                                                                        {232,122},
                                                                        {232,155},
                                                                        {NULL}
                                                                    };

const s16                   TABLE_POSITION_CRACKERS_14[14][2]   =   {
                                                                        {40,142},
                                                                        {72,110},
                                                                        {72,175},
                                                                        {88,142},
                                                                        {120,88},
                                                                        {136,122},
                                                                        {136,155},
                                                                        {120,187},
                                                                        {168,89},
                                                                        {184,122},
                                                                        {184,155},
                                                                        {168,187},
                                                                        {232,122},
                                                                        {232,155}
                                                                    };








const s16 (*TABLE_POSITION_CRACKERS[14])[14][2]                 =   {
                                                                        &TABLE_POSITION_CRACKERS_1,
                                                                        &TABLE_POSITION_CRACKERS_2,
                                                                        &TABLE_POSITION_CRACKERS_3,
                                                                        &TABLE_POSITION_CRACKERS_4,
                                                                        &TABLE_POSITION_CRACKERS_5,
                                                                        &TABLE_POSITION_CRACKERS_6,
                                                                        &TABLE_POSITION_CRACKERS_7,
                                                                        &TABLE_POSITION_CRACKERS_8,
                                                                        &TABLE_POSITION_CRACKERS_9,
                                                                        &TABLE_POSITION_CRACKERS_10,
                                                                        &TABLE_POSITION_CRACKERS_11,
                                                                        &TABLE_POSITION_CRACKERS_12,
                                                                        &TABLE_POSITION_CRACKERS_13,
                                                                        &TABLE_POSITION_CRACKERS_14
                                                                    };








void anim_CRACKERS_SCREEN_SPREAD()
{
    if(G_COUNTER_CRACKERS == 73)
    {
        VDP_loadTileSet(image_CRACKERS_SCREEN_SPREAD_BG_B3.tileset, G_ADR_VRAM_BG_B + image_CRACKERS_SCREEN_SPREAD_BG_B1.tileset->numTile, DMA_QUEUE);
        VDP_setTileMapEx(BG_B, image_CRACKERS_SCREEN_SPREAD_BG_B3.tilemap, TILE_ATTR_FULL(PAL0, FALSE, FALSE, FALSE, G_ADR_VRAM_BG_B + image_CRACKERS_SCREEN_SPREAD_BG_B1.tileset->numTile), 10, 15, 0, 0, 11, 9, DMA_QUEUE);

        VDP_loadTileSet(image_CRACKERS_SCREEN_SPREAD_BG_A3.tileset, G_ADR_VRAM_BG_A + image_CRACKERS_SCREEN_SPREAD_BG_A1.tileset->numTile, DMA_QUEUE);
        VDP_setTileMapEx(BG_A, image_CRACKERS_SCREEN_SPREAD_BG_A3.tilemap, TILE_ATTR_FULL(PAL1, FALSE, FALSE, FALSE, G_ADR_VRAM_BG_A + image_CRACKERS_SCREEN_SPREAD_BG_A1.tileset->numTile), 10, 15, 0, 0, 11, 9, DMA_QUEUE);
    
        XGM_startPlayPCM(SOUND_HAND,15,SOUND_PCM_CH4);
    }

    else if(G_COUNTER_CRACKERS == 79)
    {
        VDP_loadTileSet(image_CRACKERS_SCREEN_SPREAD_BG_B2.tileset, G_ADR_VRAM_BG_B + image_CRACKERS_SCREEN_SPREAD_BG_B1.tileset->numTile, DMA_QUEUE);
        VDP_setTileMapEx(BG_B, image_CRACKERS_SCREEN_SPREAD_BG_B2.tilemap, TILE_ATTR_FULL(PAL0, FALSE, FALSE, FALSE, G_ADR_VRAM_BG_B + image_CRACKERS_SCREEN_SPREAD_BG_B1.tileset->numTile), 10, 15, 0, 0, 11, 9, DMA_QUEUE);

        VDP_loadTileSet(image_CRACKERS_SCREEN_SPREAD_BG_A2.tileset, G_ADR_VRAM_BG_A + image_CRACKERS_SCREEN_SPREAD_BG_A1.tileset->numTile, DMA_QUEUE);
        VDP_setTileMapEx(BG_A, image_CRACKERS_SCREEN_SPREAD_BG_A2.tilemap, TILE_ATTR_FULL(PAL1, FALSE, FALSE, FALSE, G_ADR_VRAM_BG_A + image_CRACKERS_SCREEN_SPREAD_BG_A1.tileset->numTile), 10, 15, 0, 0, 11, 9, DMA_QUEUE);
    }

    else if(G_COUNTER_CRACKERS == 85)
    {
        G_INDEX_1 += 1;

        if(G_INDEX_1 < G_NUMBER_CRACKERS_MAX)
        {
            G_COUNTER_CRACKERS = 73;

            return;
        }
    }

    else if(G_COUNTER_CRACKERS == 145)
    {
        PAL_fadeOutAll(2,FALSE);
        
        G_COUNTER_CRACKERS  = 0;
        G_INDEX_1           = 0;

        // DEFINE NEXT MINIGAME //
        G_SCENE             = SCENE_FADE_OUT_CRACKERS;
        G_SCENE_TYPE        = SCENE_CRACKERS_MINIGAME;
        G_SCENE_NEXT        = SCENE_CRACKERS_MINIGAME;

        G_SCENE_LOADED      = FALSE;

        return;
    }

    G_COUNTER_CRACKERS += 1;
}




void anim_CRACKERS_SCREEN_SURPRISE()
{
    if(G_COUNTER_CRACKERS == 60)
    {
        if(G_NUMBER_CRACKERS == 0)
        {
            if(G_NUMBER_GRABBED_CRACKERS == 0)
            {
                waitMs(2000);
                PAL_fadeOutAll(40,FALSE);
            }

            else
            {
                PAL_fadeOutAll(2,FALSE);
            }
        }

        else
        {
            PAL_fadeOutAll(2,FALSE);
        }
        
        G_COUNTER_CRACKERS = 0;

        // DEFINE NEXT MINIGAME //
        if(G_NUMBER_CRACKERS == 0)
        {
            if(G_NUMBER_GRABBED_CRACKERS == 0)
            {                
                G_CRACKERS_SCREEN_TYPE  = CRACKERS_SCREEN_OVER;
            }

            else
            {
                G_CRACKERS_SCREEN_TYPE  = CRACKERS_SCREEN_SPREAD;
                G_CRACKERS_INIT         = FALSE;
            }

            G_SCENE_TYPE            = SCENE_CRACKERS_SCREEN;
            G_SCENE_NEXT            = SCENE_CRACKERS_SCREEN;
        }


        else
        {
            G_SCENE_TYPE    = SCENE_CRACKERS_MINIGAME;
            G_SCENE_NEXT    = SCENE_CRACKERS_MINIGAME;
        }


        G_SCENE_LOADED  = FALSE;

        return;
    }

    G_COUNTER_CRACKERS += 1;
}




void anim_CRACKERS_SCREEN_OVER()
{
    if(G_COUNTER_CRACKERS == 240)
    {
        // FADE OUT : 40 FRAMES //
        PAL_fadeOutAll(40,FALSE);

        // RESET SCROLLING //
        VDP_setVerticalScroll(BG_B , 0);
        VDP_setVerticalScroll(BG_A , 0);

        // CLEAR PLANES //
        VDP_clearPlane(BG_B,TRUE);
        VDP_clearPlane(BG_A,TRUE);

        // RELEASE ALL SPRITES //
        SPR_reset();

        G_COUNTER_1 = 0;

        G_PHASE_SEQUENCE = 0;

        // DEFINE NEXT MINIGAME //
        G_SCENE         = SCENE_FADE_IN;
        G_SCENE_TYPE    = SCENE_REWARD;
        G_SCENE_NEXT    = SCENE_REWARD;

        G_SCENE_LOADED  = FALSE;

        return;
    }

    G_COUNTER_CRACKERS += 1;
}








void (*TABLE_ANIM_INTERMEDIATE_SCREEN[6])(void)     =   {
                                                            anim_CRACKERS_SCREEN_SPREAD,
                                                            anim_CRACKERS_SCREEN_SURPRISE,
                                                            anim_CRACKERS_SCREEN_SURPRISE,
                                                            anim_CRACKERS_SCREEN_SURPRISE,
                                                            NULL,
                                                            anim_CRACKERS_SCREEN_OVER
                                                        };



